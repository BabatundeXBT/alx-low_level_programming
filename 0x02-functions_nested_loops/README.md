this is a loop nested function
